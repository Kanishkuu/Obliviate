services:
  redis:
    image: redis:7
    ports: ["6379:6379"]

  api:
    build:
      context: ..
      dockerfile: docker/Dockerfile.api
    env_file: ../.env
    volumes:
      - ../artifacts:/app/artifacts
      - ../uploads:/app/uploads
      - ../.hf_cache:/app/.hf_cache
    ports:
      - "${API_PORT:-8000}:8000"
    # REMOVE THIS BLOCK
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]

  worker:
    build:
      context: ..
      dockerfile: docker/Dockerfile.worker
    env_file: ../.env
    depends_on: [redis]
    volumes:
      - ../artifacts:/app/artifacts
      - ../uploads:/app/uploads
      - ../.hf_cache:/app/.hf_cache
    # REMOVE THIS BLOCK
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]